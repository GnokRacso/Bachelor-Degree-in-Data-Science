CLEAR COLUMNS
CLEAR BREAKS
CLEAR COMPUTES
CLEAR BUFFER
TTITLE OFF
CLEAR SCREEN

SET LINESIZE 120
SET PAGESIZE 100

ACCEPT ST_MONTH DATE FORMAT 'MONTH' PROMPT 'Enter the month >'

COLUMN STAFFID HEADING "Staff ID" FORMAT A10
COLUMN STAFFNAME HEADING "Staff NAME" FORMAT A30
COLUMN STAFFPOST HEADING "Staff POSITION" FORMAT A30
COLUMN CMC HEADING "CURRENT MC RECORD" FORMAT 999
COLUMN PMC HEADING "PREVIOUS MC RECORD" FORMAT 999
COLUMN COL HEADING "CURRENT LEAVE RECORD" FORMAT 999
COLUMN POL HEADING "PREVIOUS LEAVE RECORD" FORMAT 999

TTITLE LEFT '                    ===================================================================' SKIP 1 -
LEFT '                                        RECORD OF MC IN '&ST_MONTH'' SKIP 1 -
LEFT '                    ===================================================================' SKIP 2 -
LEFT 'Page: ' FORMAT 999 SQL.PNO SKIP 2
REPFOOTER SKIP 1 LEFT '                                            ---- END ----' SKIP 1

CREATE OR REPLACE VIEW CURRENT_MONTH_MC AS
SELECT S.STAFFID, S.STAFFNAME, S.STAFFPOST, COUNT(SAS.STAFFSTATUS) AS CMC
FROM STAFF S, STAFF_ACTIVITY_STATUS SAS
WHERE S.STAFFID = SAS.STAFFID AND
      SAS.STAFFSTATUS = 'MC' AND
      TO_CHAR(WORKDATE, 'MONTH') LIKE '%&ST_MONTH%'
GROUP BY S.STAFFID, S.STAFFNAME, S.STAFFPOST
ORDER BY COUNT(SAS.STAFFSTATUS) DESC;

CREATE OR REPLACE VIEW PREVIOUS_MONTH_MC AS
SELECT S.STAFFID, COUNT(SAS.STAFFSTATUS) AS PMC
FROM STAFF S, STAFF_ACTIVITY_STATUS SAS, TEMPCALENDAR T
WHERE S.STAFFID = SAS.STAFFID AND
      SAS.STAFFSTATUS = 'MC' AND
      T.CALMONTH_NAME LIKE '%&ST_MONTH%' AND
      TO_CHAR(SAS.WORKDATE, 'MM') = T.CALMONTH_NUMYEAR-1
GROUP BY S.STAFFID
ORDER BY COUNT(SAS.STAFFSTATUS) DESC;

SELECT A.*, B.PMC
FROM CURRENT_MONTH_MC A
FULL JOIN PREVIOUS_MONTH_MC B
ON A.STAFFID = B.STAFFID;

TTITLE LEFT '                       ===================================================================' SKIP 1 -
LEFT '                                       RECORD OF ANNUAL LEAVE IN '&ST_MONTH'' SKIP 1 -
LEFT '                       ===================================================================' SKIP 2 -
LEFT 'Page: ' FORMAT 999 SQL.PNO SKIP 2
REPFOOTER SKIP 1 LEFT '                                                 ---- END ----' SKIP 1

CREATE OR REPLACE VIEW CURRENT_MONTH_OL AS
SELECT S.STAFFID, S.STAFFNAME, S.STAFFPOST, COUNT(SAS.STAFFSTATUS) AS COL
FROM STAFF S, STAFF_ACTIVITY_STATUS SAS
WHERE S.STAFFID = SAS.STAFFID AND
      SAS.STAFFSTATUS = 'OL' AND
      TO_CHAR(WORKDATE, 'MONTH') LIKE '%&ST_MONTH%'
GROUP BY S.STAFFID, S.STAFFNAME, S.STAFFPOST
ORDER BY COUNT(SAS.STAFFSTATUS) DESC;

CREATE OR REPLACE VIEW PREVIOUS_MONTH_OL AS
SELECT S.STAFFID, COUNT(SAS.STAFFSTATUS) AS POL
FROM STAFF S, STAFF_ACTIVITY_STATUS SAS, TEMPCALENDAR T
WHERE S.STAFFID = SAS.STAFFID AND
      SAS.STAFFSTATUS = 'OL' AND
      T.CALMONTH_NAME LIKE '%&ST_MONTH%' AND
      TO_CHAR(SAS.WORKDATE, 'MM') = T.CALMONTH_NUMYEAR-1
GROUP BY S.STAFFID
ORDER BY COUNT(SAS.STAFFSTATUS) DESC;

SELECT C.*, D.POL
FROM CURRENT_MONTH_OL C
FULL JOIN PREVIOUS_MONTH_OL D
ON C.STAFFID = D.STAFFID;