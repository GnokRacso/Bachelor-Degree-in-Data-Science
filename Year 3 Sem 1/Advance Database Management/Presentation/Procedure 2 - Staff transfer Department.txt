CREATE OR REPLACE PROCEDURE PCR_STAFF_CHANGE_POSITION
                  (IN_STAFFID IN STAFF.STAFFID%TYPE, 
                   IN_STAFF_POSITION IN STAFF.STAFFPOST%TYPE) IS

    V_STAFFNAME STAFF.STAFFNAME%TYPE;
    V_OLDSTAFFPOST STAFF.STAFFPOST%TYPE;
    V_NEWSTAFFPOST STAFF_POSITION.STAFFPOST%TYPE;
    V_OLDSALARY STAFF_SALARY.SALARYNUM%TYPE;
    V_NEWSALARY STAFF_POSITION.POSTSALARY%TYPE;

    E_INVALID_STAFFID EXCEPTION;
    PRAGMA EXCEPTION_INIT (E_INVALID_STAFFID, -20100); 
BEGIN
    IF FUN_VALIDATE_STAFFID(IN_STAFFID) = FALSE THEN
        RAISE_APPLICATION_ERROR(-20100, 'Invalid Staff ID!');
    END IF;

    DBMS_OUTPUT.PUT_LINE('Valid Input!');

    SELECT S.STAFFNAME INTO V_STAFFNAME
    FROM STAFF S
    WHERE S.STAFFID = IN_STAFFID;

    SELECT S.STAFFPOST INTO V_OLDSTAFFPOST
    FROM STAFF S
    WHERE S.STAFFID = IN_STAFFID;

    SELECT SS.SALARYNUM INTO V_OLDSALARY
    FROM STAFF_SALARY SS
    WHERE SS.STAFFID = IN_STAFFID;

    SELECT SP.STAFFPOST INTO V_NEWSTAFFPOST
    FROM STAFF_POSITION SP
    WHERE SP.STAFFPOST = IN_STAFF_POSITION;

    SELECT SP.POSTSALARY INTO V_NEWSALARY
    FROM STAFF_POSITION SP
    WHERE SP.STAFFPOST = IN_STAFF_POSITION;

    UPDATE STAFF
        SET STAFFPOST = V_NEWSTAFFPOST
        WHERE STAFFID = IN_STAFFID;

    UPDATE STAFF_SALARY
        SET SALARYNUM = V_NEWSALARY
        WHERE STAFFID = IN_STAFFID;

    DBMS_OUTPUT.PUT_LINE(CHR(10) || RPAD('-', 60, '-'));
    DBMS_OUTPUT.PUT_LINE('Staff ID    : ' || IN_STAFFID);
    DBMS_OUTPUT.PUT_LINE('Staff NAME  : ' || V_STAFFNAME);    
    DBMS_OUTPUT.PUT_LINE('Old POSITION: ' || V_OLDSTAFFPOST);
    DBMS_OUTPUT.PUT_LINE('New POSITION: ' || V_NEWSTAFFPOST);
    DBMS_OUTPUT.PUT_LINE('Salary from RM' || V_OLDSALARY || ' to RM' || V_NEWSALARY);
    DBMS_OUTPUT.PUT_LINE('RECORD UPDATED SUCCESSFULLY!');
    DBMS_OUTPUT.PUT_LINE(CHR(10) || RPAD('-', 60, '-'));

EXCEPTION
    WHEN E_INVALID_STAFFID THEN 
        DBMS_OUTPUT.PUT_LINE(SQLERRM);
    WHEN NO_DATA_FOUND THEN
        DBMS_OUTPUT.PUT_LINE('Position NOT FOUND or MISSPELLED');
        DBMS_OUTPUT.PUT_LINE('Please TRY Again :)');
END;
/